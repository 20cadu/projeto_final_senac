<!DOCTYPE html>
{% load static %}
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>PromoMarket</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"> <!-- BootStrap -->
</head>
<body class="" style="background-color: RoyalBlue; padding-top: 70px;">
    <!-- Navbar -->
    <nav class='' style="background-color: SteelBLue;
      padding: 0;
      overflow: hidden;
      border-bottom: 2px LightSeaGreen solid;
      box-shadow: 4px 4px 5px 5px rgb(0,0,0, 0.15);
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1050;
    ">
      <div style="display: flex; align-items: center; justify-content: space-between; height: 60px; padding: 0 1rem;">
        <a href="{% url 'main' %}" style="display: flex; align-items: center; margin: 0; padding: 0;">
          <img
            src="https://res.cloudinary.com/dxhx9tcow/image/upload/v1754347620/Logo_moderno_Promo_Market_nyznxh.png"
            alt="Logo"
            style="max-height: 125px; width: auto; display: block; object-fit: contain;"
          >
        </a>
        <div class="d-flex" style="gap: 5px">
            {% if user.is_authenticated and user.is_staff %}
            <form method="get" action="{% url 'produtos' %}">
              <button class="btn btn-outline-info" type="submit">Produtos</button>
            </form>
            {% endif %}
            {% if user.is_authenticated and request.path != '/login/' %}
            <form method="post" action="{% url 'logout' %}">
              {% csrf_token %}
              <button class="btn btn-outline-danger" type="submit">Sair</button>
            </form>
            {% else %}
            <a class="btn btn-outline-success" href="{% url 'login' %}">Entrar</a>
            {% endif %}
        </div>
      </div>
    </nav>

    <!-- Carrinho Virtual -->
    <div id="carrinho-container" style="position:fixed;top:70px;right:20px;z-index:1000;">
      <button id="abrir-carrinho" class="btn btn-success btn-sm">
        Carrinho (<span id="carrinho-quantidade">0</span>)
      </button>
      <div id="carrinho-itens" style="display:none;background:#fff;padding:10px;border:1px solid #ccc;min-width:220px;">
        <h5>Itens no carrinho</h5>
        <ul id="lista-carrinho" style="padding-left: 1rem;"></ul>
        <button id="confirmar-compra" class="btn btn-primary btn-sm mt-2">Confirmar compra</button>
        <button id="fechar-carrinho" class="btn btn-secondary btn-sm mt-2">Fechar</button>
      </div>
    </div>

    <!-- Conteúdo -->
    {% block content %}{% endblock %}

</body>

<script>
function atualizarCarrinho() {
    fetch('/carrinho/list/', {
        method: 'GET',
        headers: {
            'X-Requested-With': 'XMLHttpRequest'
        }
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('carrinho-quantidade').textContent = data.itens.length;
        const lista = document.getElementById('lista-carrinho');
        lista.innerHTML = '';
        data.itens.forEach(item => {
            const li = document.createElement('li');
            li.textContent = item.nome + ' - R$' + item.preco;
            lista.appendChild(li);
        });
    });
}

document.addEventListener('DOMContentLoaded', function () {
    atualizarCarrinho();

    document.getElementById('abrir-carrinho').onclick = function() {
        document.getElementById('carrinho-itens').style.display = 'block';
        atualizarCarrinho();
    };
    document.getElementById('fechar-carrinho').onclick = function() {
        document.getElementById('carrinho-itens').style.display = 'none';
    };

    document.getElementById('confirmar-compra').onclick = function() {
        // Verifica se o usuário está autenticado
        {% if user.is_authenticated %}
            window.location.href = '/carrinho/confirmar/';
        {% else %}
            alert('Você precisa estar logado para confirmar a compra!');
            window.location.href = '{% url "login" %}';
        {% endif %}
    };
});
</script>

<style>
  .scroll-row {
    display: flex;
    overflow-x: auto;
    gap: 1rem;
    padding-bottom: 1rem;
    scroll-behavior: smooth;
  }

  .scroll-row::-webkit-scrollbar {
    height: 6px;
  }

  .scroll-row::-webkit-scrollbar-thumb {
    background: #aaa;
    border-radius: 4px;
  }

  .card {
    width: 200px;
    height: 400px; /* Tamanho fixo para todos os cards */
    flex: 0 0 auto;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    overflow: hidden;
    box-sizing: border-box;
  }

  .card-img-top {
    width: 100%;
    height: 180px;
    object-fit: cover;
    object-position: center;
    border-bottom: 1px solid #eee;
    flex-shrink: 0;
  }

  .card-body {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    padding: 10px;
    overflow: hidden;
  }

  .card-title {
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>

</html>